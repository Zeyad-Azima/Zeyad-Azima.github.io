<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>CVE-2023-24815: Vert.x-Web Path Traversal Escape - Zeyad Azima</title>
<meta name="description" content="A detailed analysis for a vulnerability discovered in Vert.x-Web known as CVE-2023-24815. ">


  <meta name="author" content="Zeyad Azima">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Zeyad Azima">
<meta property="og:title" content="CVE-2023-24815: Vert.x-Web Path Traversal Escape">
<meta property="og:url" content="http://localhost:5000/security%20research/CVE_2023_24815/">


  <meta property="og:description" content="A detailed analysis for a vulnerability discovered in Vert.x-Web known as CVE-2023-24815. ">



  <meta property="og:image" content="http://localhost:5000/assets/images/clgcyasp6268k0js3byulgcph.png">





  <meta property="article:published_time" content="2023-04-12T00:00:00+08:00">





  

  


<link rel="canonical" href="http://localhost:5000/security%20research/CVE_2023_24815/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Zeyad Azima",
      "url": "http://localhost:5000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Zeyad Azima Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site_data/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site_data/favicon-16x16.png">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/site_data/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Zeyad Azima
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/#Security-Research">Security Research</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#MacOS">MacOS</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#IoT-Exploitation">IoT Exploitation</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Defense-Evasion">Defense Evasion</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#General">General</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Certificates">Certificates</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">All Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site_data/avatar.jpg" alt="Zeyad Azima" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Zeyad Azima</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Brain Storming Stuff (Exploit Development, Reverse Engineering &amp; More)</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="mailto:contact@zeyadazima.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://twitter.com/AzimaZeyad" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/zer0verflow/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/Zeyad-Azima" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/zeyadazima" rel="nofollow noopener noreferrer"><i class="fas fa-mug-hot" aria-hidden="true"></i><span class="label">Buy Me a Coffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="CVE-2023-24815: Vert.x-Web Path Traversal Escape">
    <meta itemprop="description" content="IntroductionA vulnerability discovered in Vert.x-Web known as CVE-2023-24815, a threat actor can exploit this vulnerability to escape the path filter leading to exfiltrate any class path resource or Path Traversal, When tunning on windows.">
    <meta itemprop="datePublished" content="2023-04-12T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">CVE-2023-24815: Vert.x-Web Path Traversal Escape
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#cve-information">CVE Information</a></li>
  <li><a href="#testing-lab">Testing Lab</a></li>
  <li><a href="#what-is-vertx-web-">What is Vert.x-Web ?</a></li>
  <li><a href="#the-analaysis">The Analaysis</a></li>
  <li><a href="#patch-diffing">Patch Diffing</a></li>
  <li><a href="#conclusion">Conclusion</a>
    <ul>
      <li><a href="#references">References</a></li>
    </ul>
  </li>
</ul>

            </nav>
          </aside>
        
        <h1 id="introduction">Introduction</h1>
<p>A vulnerability discovered in <code class="language-plaintext highlighter-rouge">Vert.x-Web</code> known as <code class="language-plaintext highlighter-rouge">CVE-2023-24815</code>, a threat actor can exploit this vulnerability to escape the path filter leading to exfiltrate any class path resource or Path Traversal, When tunning on windows.</p>

<h1 id="cve-information">CVE Information</h1>
<ul>
  <li><code class="language-plaintext highlighter-rouge">CVE-ID</code>: CVE-2023-24815</li>
  <li><code class="language-plaintext highlighter-rouge">NVD Published Date</code>:  02/09/2023</li>
  <li><code class="language-plaintext highlighter-rouge">NVD Last Modified</code>:  02/17/2023</li>
  <li><code class="language-plaintext highlighter-rouge">CVSS 3.x</code>: 5.3 MEDIUM</li>
  <li><code class="language-plaintext highlighter-rouge">CWE-ID</code>: Improper Limitation of a Pathname to a Restricted Directory (<code class="language-plaintext highlighter-rouge">Path Traversal</code>)</li>
</ul>

<h1 id="testing-lab">Testing Lab</h1>
<p>We would need an <code class="language-plaintext highlighter-rouge">IDE</code> in trhis case i am using <code class="language-plaintext highlighter-rouge">IntelliJ</code> and we would need any version of the Vert.x-Web before <code class="language-plaintext highlighter-rouge">4.3.8</code>. You can download the <code class="language-plaintext highlighter-rouge">JAR</code> library for it from <a href="https://jar-download.com/artifacts/io.vertx/vertx-web">here</a>.</p>

<h1 id="what-is-vertx-web-">What is Vert.x-Web ?</h1>
<p>Vert.x-Web is a toolkit for building web applications and <code class="language-plaintext highlighter-rouge">APIs</code> using the Vert.x framework which is a polyglot, reactive, and high performance application platform for the Java Virtual Machine (<code class="language-plaintext highlighter-rouge">JVM</code>). It allows developers to write applications by providing  a set of building blocks for creating it which include routing, authentication, authorization, templating, and serving static files. With its modular and lightweight design, Vert.x-Web enables developers to build scalable, high-performance web applications and <code class="language-plaintext highlighter-rouge">APIs</code> quickly and efficiently. Features of Vert.x-Web include:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Flexible routing</code>: Define and match routes based on request methods, paths, headers, and more. You can also add request handlers, failure handlers, and response handlers to routes.</li>
  <li><code class="language-plaintext highlighter-rouge">Authentication and authorization</code>: Support for a variety of authentication and authorization mechanisms, including <code class="language-plaintext highlighter-rouge">OAuth2</code>, <code class="language-plaintext highlighter-rouge">JWT</code>, <code class="language-plaintext highlighter-rouge">Basic</code>, and <code class="language-plaintext highlighter-rouge">Digest</code> authentication.</li>
  <li><code class="language-plaintext highlighter-rouge">Static file handling</code>: Serve static files from the file system or classpath resources.</li>
  <li><code class="language-plaintext highlighter-rouge">WebSockets and Server-Sent Events</code>: Support for real-time communication between clients and the server using WebSockets and Server-Sent Events.</li>
  <li><code class="language-plaintext highlighter-rouge">CORS and CSRF</code>: Built-in support for Cross-Origin Resource Sharing (<code class="language-plaintext highlighter-rouge">CORS</code>) and Cross-Site Request Forgery (<code class="language-plaintext highlighter-rouge">CSRF</code>) protection.</li>
  <li><code class="language-plaintext highlighter-rouge">Templating engines</code>: Support for multiple templating engines, such as Handlebars, Jade, and Thymeleaf.</li>
</ul>

<h1 id="the-analaysis">The Analaysis</h1>
<p>The vulnerability in Vert.x-Web applications running on Windows operating systems when using the <code class="language-plaintext highlighter-rouge">StaticHandler</code> with a wildcard mount point (<code class="language-plaintext highlighter-rouge">*</code>) is caused by insufficient input validation and improper handling of backslashes in user input, When request is made to the application with a crafted path the <code class="language-plaintext highlighter-rouge">Utils.java</code> code computes the relative path to locate the resource using the wildcard mount point, Here is example for the code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import io.vertx.core.Vertx;
import io.vertx.ext.web.Router;
import io.vertx.ext.web.handler.StaticHandler;

public class Main {

  public static void main(String[] args) {
    Vertx vertx = Vertx.vertx();
    Router router = Router.router(vertx);

    // Configure the StaticHandler with a wildcard mount point
    router.route("/*").handler(StaticHandler.create());

    vertx.createHttpServer().requestHandler(router).listen(8080);
  }
}
</code></pre></div></div>

<p>This will setup up a simple <code class="language-plaintext highlighter-rouge">HTTP</code> server and configure it to handle incoming requests using the <code class="language-plaintext highlighter-rouge">Router</code> and start listening on port <code class="language-plaintext highlighter-rouge">8080</code>. 
Now, Let’s take a look at the vulnerable code to analyze it and understand how the app handle the path. Here is the path for the class (<code class="language-plaintext highlighter-rouge">vertx-web/src/main/java/io/vertx/ext/web/impl/Utils.java</code>). The <code class="language-plaintext highlighter-rouge">Utils.java</code> Class contains a lot of function and the class contains various utility methods used internally by Vert.x-Web for handling requests, responses, and other web-related tasks and some of the utility methods in the <code class="language-plaintext highlighter-rouge">Utils.java</code> class include:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Parsing and normalizing paths</code>: The class has methods for normalizing paths and removing redundant path elements (e.g., <code class="language-plaintext highlighter-rouge">./</code> and <code class="language-plaintext highlighter-rouge">../</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">Handling MIME types</code>: There are methods for getting MIME types based on file extensions and determining the most suitable content type based on the “Accept” header in HTTP requests.</li>
  <li><code class="language-plaintext highlighter-rouge">Handling URL encoding and decoding</code>: Utility methods for URL encoding and decoding of strings.</li>
  <li><code class="language-plaintext highlighter-rouge">Parsing and handling cookies</code>: Methods for parsing cookies from request headers and creating Set-Cookie headers for responses.</li>
</ul>

<p>Now, when we scroll down through the class we can see the following method <code class="language-plaintext highlighter-rouge">pathOffset</code>.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static String pathOffset(String path, RoutingContext context) {
</code></pre></div></div>
<p>First is the define of the <code class="language-plaintext highlighter-rouge">pathOffset</code>  method and it  takes a <code class="language-plaintext highlighter-rouge">String</code> representing the <code class="language-plaintext highlighter-rouge">path</code> and a <code class="language-plaintext highlighter-rouge">RoutingContext</code> as arguments.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>final Route route = context.currentRoute();
</code></pre></div></div>

<p>Here it’s getting the current <code class="language-plaintext highlighter-rouge">Route</code> from the <code class="language-plaintext highlighter-rouge">RoutingContext</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (route == null) {
  return path;
} if (!route.isExactPath()) {
  final String rest = context.pathParam("*");
  if (rest != null) {
		if (rest.length() &gt; 0) {
		  if (rest.charAt(0) == '/') {
			return rest;
		  } else {
			return "/" + rest;
		  }
		} else {
		  return "/";
		}
	  }
	}  
</code></pre></div></div>

<p>In this condition If there’s no current route will return the original path, If not null it will check if the current route is not an exact path match, if yes Retrieve the wildcard path parameter (denoted by <code class="language-plaintext highlighter-rouge">*</code>) and then check if the wildcard path parameter exists. If the wildcard path parameter exists it will normalize the wildcard path parameter by ensuring it starts with a forward slash (<code class="language-plaintext highlighter-rouge">/</code>) and return it. If the parameter is empty it return a single forward slash. And here where is the problem occures.</p>

<h1 id="patch-diffing">Patch Diffing</h1>
<p>The patch for this vulnerability done as the following(We can find the commit <a href="https://github.com/vert-x3/vertx-web/commit/9e3a783b1d1a731055e9049078b1b1494ece9c15">here</a>):
First it’s  added the following lines to the <code class="language-plaintext highlighter-rouge">Utils.java</code> class:
<img src="/assets/images/23d5d09db649988d9cb5d444798c3c7c.png" alt="23d5d09db649988d9cb5d444798c3c7c.png" />
And the doal of adding this lines is to remove the backslashes <code class="language-plaintext highlighter-rouge">\</code> with the forwardslashes <code class="language-plaintext highlighter-rouge">/</code>. Second they added new class called <code class="language-plaintext highlighter-rouge">StaticHandlerWindowsTest</code> and te purpose of this class is to test the behavior of the <code class="language-plaintext highlighter-rouge">StaticHandler</code> class on Windows operating systems. This is done by testing the ability of the <code class="language-plaintext highlighter-rouge">StaticHandler</code> class to prevent path traversal attacks by attempting to escape to the classpath from different types of routes. Class Code:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package io.vertx.ext.web.handler;

import io.vertx.core.http.HttpMethod;
import io.vertx.ext.web.WebTestBase;
import org.junit.Test;

public class StaticHandlerWindowsTest extends WebTestBase {

  @Test
  public void testEscapeToClasspathFromWildcard() throws Exception {
    router.clear();
    router.route("/*").handler(StaticHandler.create("www"));
    // attempt to escape to classpath, given that the handler is mounted on a wildcard,
    // reading the wildcard must return a sanitized path and therefore not allow to escape.
    testRequest(HttpMethod.GET, "/..\\.htdigest", 404, "Not Found");
  }

  @Test
  public void testEscapeToClasspathFromNull() throws Exception {
    router.clear();
    router.route().handler(StaticHandler.create("www"));
    // attempt to escape to classpath, given that the handler is mounted on a catch all path
    testRequest(HttpMethod.GET, "/..\\.htdigest", 404, "Not Found");
  }

  @Test
  public void testEscapeToClasspathFromRegEx() throws Exception {
    router.clear();
    router.routeWithRegex(".*").handler(StaticHandler.create("www"));
    // attempt to escape to classpath, given that the handler is mounted on a regex,
    testRequest(HttpMethod.GET, "/..\\.htdigest", 404, "Not Found");
  }

  @Test
  public void testEscapeToClasspathFromFixedPath() throws Exception {
    router.clear();
    router.routeWithRegex("/").handler(StaticHandler.create("www"));
    // attempt to escape to classpath, given that the handler is mounted on a regex,
    testRequest(HttpMethod.GET, "/..\\.htdigest", 404, "Not Found");
  }
}
</code></pre></div></div>

<h1 id="conclusion">Conclusion</h1>
<p>Finally, We highlighted the issue and the mistake behind it &amp; explained the vulnerable code by analyzing and going through it, Also, We discuss the the patch and how the vulnerability got patched in a simple way. To protect yourself from this vulnerability simply upgrade to the last version</p>

<h2 id="references">References</h2>
<ul>
  <li>https://vertx.io/docs/vertx-web/java/</li>
  <li>https://github.com/vert-x3/vertx-web/blob/62c0d66fa1c179ae6a4d57344631679a2b97e60f/vertx-web/src/main/java/io/vertx/ext/web/impl/Utils.java#L83</li>
  <li>https://github.com/vert-x3/vertx-web/commit/9e3a783b1d1a731055e9049078b1b1494ece9c15</li>
  <li>https://github.com/vert-x3/vertx-web</li>
  <li>https://jar-download.com/artifacts/io.vertx/vertx-web</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#security-research" class="page__taxonomy-item" rel="tag">Security Research</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2023-04-12T00:00:00+08:00">April 12, 2023</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/iot%20exploitation/CVE_2021_42885/" class="pagination--pager" title="CVE-2021-42885: deviceMac Remote Command Injection
">Previous</a>
    
    
      <a href="/security%20research/CVE_2022_22733/" class="pagination--pager" title="CVE-2022-22733: Apache ShardingSphere ElasticJob-UI privilege escalation
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Zeyad Azima. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
