<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Exploit Writing (N0Pspoof): Portspoof Evasion - Zeyad Azima</title>
<meta name="description" content="Writing Exploit for Portspoof using C. ">


  <meta name="author" content="Zeyad Azima">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Zeyad Azima">
<meta property="og:title" content="Exploit Writing (N0Pspoof): Portspoof Evasion">
<meta property="og:url" content="http://localhost:5000/defense%20evasion/portspoofexploit/">


  <meta property="og:description" content="Writing Exploit for Portspoof using C. ">



  <meta property="og:image" content="http://localhost:5000/assets/images/cld16nld9rzuy0jp87q41e835.png">





  <meta property="article:published_time" content="2023-01-24T00:00:00+08:00">





  

  


<link rel="canonical" href="http://localhost:5000/defense%20evasion/portspoofexploit/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Zeyad Azima",
      "url": "http://localhost:5000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Zeyad Azima Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site_data/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site_data/favicon-16x16.png">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/site_data/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Zeyad Azima
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/#Security-Research">Security Research</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#MacOS">MacOS</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#IoT-Exploitation">IoT Exploitation</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Defense-Evasion">Defense Evasion</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#General">General</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Certificates">Certificates</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">All Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site_data/avatar.jpg" alt="Zeyad Azima" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Zeyad Azima</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Brain Storming Stuff (Exploit Development, Reverse Engineering &amp; More)</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="mailto:contact@zeyadazima.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://twitter.com/AzimaZeyad" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/zer0verflow/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/Zeyad-Azima" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/zeyadazima" rel="nofollow noopener noreferrer"><i class="fas fa-mug-hot" aria-hidden="true"></i><span class="label">Buy Me a Coffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Exploit Writing (N0Pspoof): Portspoof Evasion">
    <meta itemprop="description" content="Introduction">
    <meta itemprop="datePublished" content="2023-01-24T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Exploit Writing (N0Pspoof): Portspoof Evasion
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  11 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#writing-our-tool">Writing Our tool</a>
    <ul>
      <li><a href="#header-files">Header files</a></li>
      <li><a href="#scanning-functions">Scanning Functions</a></li>
      <li><a href="#main-function">Main function</a></li>
      <li><a href="#full-code">Full Code:</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

            </nav>
          </aside>
        
        <h1 id="introduction"><strong>Introduction</strong></h1>

<p>In the previous blog (<a href="https://zeyadazima.com/defense%20evasion/portspoof/">Read Here</a>), <code class="language-plaintext highlighter-rouge">Portspoof</code> explained well and how we can abuse it’s logic to bypass it. Now, it’s the time to write a full exploit to take advantaged of it and scan a range of ports.</p>

<p> </p>

<h1 id="writing-our-tool"><strong>Writing Our tool</strong></h1>

<h2 id="header-files"><strong>Header files</strong></h2>

<p>These are all C header files that are being included in the code. Each of them contains declarations for functions, variables and types that are used in the code that follows.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;sys/socket.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;errno.h&gt;
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">#include &lt;sys/socket.h&gt;</code>: This header file contains the definitions of the socket-related data types, structures, and functions needed for socket programming. It includes the definitions for creating and manipulating sockets, as well as functions for interacting with the underlying transport protocol (typically TCP or UDP).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">#include &lt;arpa/inet.h&gt;</code>: This header file contains the definitions for internet operations such as IP addresses, port numbers, and protocol families. It provides functions to convert between human-readable and network-readable addresses, and also defines constants for common internet protocols such as TCP and UDP.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">#include &lt;unistd.h&gt;</code>: This header file provides various system calls and library functions that are used for performing basic file and process management operations in POSIX systems, like read, write, close, sleep, getpid, etc.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">#include &lt;string.h&gt;</code>: This header file contains a set of functions to manipulate arrays of characters, such as strcmp, strcpy, strlen, etc.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">#include &lt;sys/time.h&gt;</code>: This header file provides functions and data structures for measuring time, like gettimeofday, timeval, timespec, etc.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">#include &lt;errno.h&gt;</code>: This header file contains the global variable errno, which is set by various library functions and system calls to indicate the error that occurred during their execution. It also contains some commonly used error codes and macros.</p>

    <p> </p>
  </li>
</ul>

<h2 id="scanning-functions"><strong>Scanning Functions</strong></h2>

<ul>
  <li>TCP</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void TCP_scan(char* host, int start_port, int end_port, struct timeval timeout) {
    for (int port = start_port; port &lt;= end_port; port++) {
        int sock = socket(AF_INET, SOCK_STREAM, 0);
        setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO, (const char*)&amp;timeout, sizeof timeout);
        struct sockaddr_in server;
        server.sin_addr.s_addr = inet_addr(host);
        server.sin_family = AF_INET;
        server.sin_port = htons(port);

        if (connect(sock, (struct sockaddr *) &amp;server, sizeof(server)) == 0) {
            char buffer[32];
            int bytes_sent = send(sock, buffer, sizeof(buffer), 0);
            if (bytes_sent &gt; 0) {
                int bytes_received = recv(sock, buffer, sizeof(buffer), 0);
                if (bytes_received &gt; 0) {
                    printf("[+] Port %d is open\n", port);
                } else if (bytes_received == -1 &amp;&amp; errno == EAGAIN) {
                    printf("[+] Port %d is open\n", port);
                }
            }
            close(sock);
        } else {
            //printf("[+] Port %d is closed\n", port);
        }
        close(sock);
    }
}
</code></pre></div></div>

<p> </p>

<p>The <code class="language-plaintext highlighter-rouge">TCP</code> function takes four parameters:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">host</code>: a char pointer to the hostname or IP address of the target machine.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">start_port</code>: an integer representing the start of the port range to be scanned.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">end_port</code>: an integer representing the end of the port range to be scanned.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">timeout</code>: a struct timeval representing the timeout for the receive operation.</p>

    <p> </p>
  </li>
</ul>

<p>The function starts a for loop that iterates through all the ports in the specified range. For each port, it creates a new socket using the <code class="language-plaintext highlighter-rouge">socket()</code> function, with the <code class="language-plaintext highlighter-rouge">AF_INET</code> parameter for IPv4 addresses, <code class="language-plaintext highlighter-rouge">SOCK_STREAM</code> for <code class="language-plaintext highlighter-rouge">TCP</code> protocol,Then sets the timeout value for the socket using the <code class="language-plaintext highlighter-rouge">setsockopt()</code> function with the <code class="language-plaintext highlighter-rouge">SOL_SOCKET</code> and <code class="language-plaintext highlighter-rouge">SO_RCVTIMEO</code> options. Next, the function creates a struct <code class="language-plaintext highlighter-rouge">sockaddr_in</code> called server, which is used to store the host’s IP address and port number. The function converts the host’s IP address to a 32-bit number using <code class="language-plaintext highlighter-rouge">inet_addr()</code> and sets the <code class="language-plaintext highlighter-rouge">sin_addr.s_addr</code> field of the server struct. The sin_family field is set to <code class="language-plaintext highlighter-rouge">AF_INET</code> and the <code class="language-plaintext highlighter-rouge">sin_port</code> field is set to the current port number in the for loop, converted to network byte order using <code class="language-plaintext highlighter-rouge">htons()</code>. The function then creates a buffer and sends an empty packet to the server using the <code class="language-plaintext highlighter-rouge">sendto()</code> function. If the <code class="language-plaintext highlighter-rouge">sendto()</code> function returns a value greater than <code class="language-plaintext highlighter-rouge">0</code>, it means that the packet was sent successfully. Then uses the <code class="language-plaintext highlighter-rouge">recv()</code> function to receive a response from the server. If the <code class="language-plaintext highlighter-rouge">recv()</code> function returns a value greater than <code class="language-plaintext highlighter-rouge">0</code>, it means that there is an open port, and the function prints a message indicating that the port is open. If the <code class="language-plaintext highlighter-rouge">recv()</code> function returns <code class="language-plaintext highlighter-rouge">-1</code> and the errno value is <code class="language-plaintext highlighter-rouge">EAGAIN</code>, it means that the response timed out and the port is open. Finally, the function closes the socket using the <code class="language-plaintext highlighter-rouge">close()</code> function. The function repeats the process for all the ports in the specified range.</p>

<p> </p>

<ul>
  <li>UDP</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void UDP_scan(char* host, int start_port, int end_port, struct timeval timeout) {
    for (int port = start_port; port &lt;= end_port; port++) {
        int sock = socket(AF_INET, SOCK_DGRAM, 0);
        setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO, (const char*)&amp;timeout, sizeof timeout);
        struct sockaddr_in server;
        server.sin_addr.s_addr = inet_addr(host);
        server.sin_family = AF_INET;
        server.sin_port = htons(port);
        char buffer[32];
        int bytes_sent = sendto(sock, buffer, sizeof(buffer), 0, (struct sockaddr *)&amp;server, sizeof(server));
        if (bytes_sent &gt; 0) {
            int bytes_received = recv(sock, buffer, sizeof(buffer), 0);
            if (bytes_received &gt; 0) {
                printf("[+] Port %d is open\n", port);
            } else if (bytes_received == -1 &amp;&amp; errno == EAGAIN) {
                printf("[+] Port %d is open\n", port);
            }
        } else {
            //printf("[+] Port %d is closed\n", port);
        }
        close(sock);
    }
}
</code></pre></div></div>

<p> </p>

<p>The <code class="language-plaintext highlighter-rouge">UDP</code> function takes four parameters:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">host</code>: a char pointer to the hostname or IP address of the target machine.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">start_port</code>: an integer representing the start of the port range to be scanned.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">end_port</code>: an integer representing the end of the port range to be scanned.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">timeout</code>: a struct timeval representing the timeout for the receive operation.</p>

    <p> </p>
  </li>
</ul>

<p>The function starts a for loop that iterates through all the ports in the specified range. For each port, it creates a new socket using the <code class="language-plaintext highlighter-rouge">socket()</code> function, with the <code class="language-plaintext highlighter-rouge">AF_INET</code> parameter for IPv4 addresses, <code class="language-plaintext highlighter-rouge">SOCK_DGRAM</code> for <code class="language-plaintext highlighter-rouge">UDP</code> protocol, and a value of <code class="language-plaintext highlighter-rouge">0</code> for the protocol.Then sets the timeout value for the socket using the <code class="language-plaintext highlighter-rouge">setsockopt()</code> function with the <code class="language-plaintext highlighter-rouge">SOL_SOCKET</code> and <code class="language-plaintext highlighter-rouge">SO_RCVTIMEO</code> options. Next, the function creates a struct <code class="language-plaintext highlighter-rouge">sockaddr_in</code> called server, which is used to store the host’s IP address and port number. The function converts the host’s IP address to a 32-bit number using <code class="language-plaintext highlighter-rouge">inet_addr()</code> and sets the <code class="language-plaintext highlighter-rouge">sin_addr.s_addr</code> field of the server struct. The sin_family field is set to <code class="language-plaintext highlighter-rouge">AF_INET</code> and the <code class="language-plaintext highlighter-rouge">sin_port</code> field is set to the current port number in the for loop, converted to network byte order using <code class="language-plaintext highlighter-rouge">htons()</code>. The function then creates a buffer and sends an empty packet to the server using the <code class="language-plaintext highlighter-rouge">sendto()</code> function. If the <code class="language-plaintext highlighter-rouge">sendto()</code> function returns a value greater than <code class="language-plaintext highlighter-rouge">0</code>, it means that the packet was sent successfully. Then uses the <code class="language-plaintext highlighter-rouge">recv()</code> function to receive a response from the server. If the <code class="language-plaintext highlighter-rouge">recv()</code> function returns a value greater than <code class="language-plaintext highlighter-rouge">0</code>, it means that there is an open port, and the function prints a message indicating that the port is open. If the <code class="language-plaintext highlighter-rouge">recv()</code> function returns <code class="language-plaintext highlighter-rouge">-1</code> and the errno value is <code class="language-plaintext highlighter-rouge">EAGAIN</code>, it means that the response timed out and the port is open. Finally, the function closes the socket using the <code class="language-plaintext highlighter-rouge">close()</code> function. The function repeats the process for all the ports in the specified range.</p>

<p> </p>

<h2 id="main-function"><strong>Main function</strong></h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int main() {
    char host[256];
    int start_port, end_port;
    struct timeval timeout;
    timeout.tv_sec = 5;
   
    timeout.tv_usec = 0;
    int scan_type;
    printf("[+] N0Pspoof is a tool to bypass and evade Portspoof solution \n");
    printf("[+] By: Zeyad Azima\n");
    printf("[+] Github: https://github.com/Zeyad-Azima/N0Pspoof\n");
    printf("\n");
    printf("[+] Target Behind Portspoof: ");
    scanf("%255s", host);

    printf("[+] Enter the start port: ");
    scanf("%d", &amp;start_port);
    printf("[+] Enter the end port: ");
    scanf("%d", &amp;end_port);

    printf("[+] Choose the scan type: \n 1) TCP \n 2) UDP \n");
    scanf("%d", &amp;scan_type);
    printf("\n");
    
    

    if (scan_type == 1) {
        printf("[+] Scan Info:\n[*] Target: %s	[*] Ports Range: %d-%d	[*] Scan Type: TCP\n", host, start_port, end_port);
        TCP_scan(host, start_port, end_port, timeout);
    } else if (scan_type == 2) {
        printf("[+] Scan Info:\n[*] Target: %s	[*] Ports Range: %d-%d	[*] Scan Type: UDP\n", host, start_port, end_port);
        UDP_scan(host, start_port, end_port, timeout);
    } else {
        printf("Invalid scan type\n");
    }
    return 0;

}
</code></pre></div></div>

<p> </p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">host</code>: is an array of characters with a maximum size of 256, which will be used to store the target host entered by the user.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">start_port</code>: and <code class="language-plaintext highlighter-rouge">end_port</code>: are integers that will be used to store the start and end ports entered by the user.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">timeout</code>: is a struct of type <code class="language-plaintext highlighter-rouge">timeval</code>, which is used to store the timeout value for the scan. The struct has two members: <code class="language-plaintext highlighter-rouge">tv_sec</code> and <code class="language-plaintext highlighter-rouge">tv_usec</code>. In this case, <code class="language-plaintext highlighter-rouge">tv_sec</code> is set to 5 indicating that the timeout for the scan is 5 seconds. <code class="language-plaintext highlighter-rouge">tv_usec</code> is set to 0, indicating that the timeout is in seconds and not microseconds.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">scan_type</code>: is an integer that will be used to store the scan type chosen by the user.</p>
  </li>
</ul>

<p> </p>

<p>When the code starts it prompts for the user to enter the target host, start and end ports, and scan type. The user input is stored in the variables:</p>

<ul>
  <li>
    <p>host</p>
  </li>
  <li>
    <p>start_port</p>
  </li>
  <li>
    <p>end_port</p>
  </li>
  <li>
    <p>scan_type</p>
  </li>
</ul>

<p>Then checks the value of <code class="language-plaintext highlighter-rouge">scan_type</code> using an <code class="language-plaintext highlighter-rouge">if-else</code> statement. If the value of <code class="language-plaintext highlighter-rouge">scan_type</code> is 1, it means the user has chosen a TCP scan, and the program will call the <code class="language-plaintext highlighter-rouge">TCP_scan</code> function, passing in the host, start and end ports, and the timeout value. If the value of <code class="language-plaintext highlighter-rouge">scan_type</code> is 2, it means the user has chosen a UDP scan, and the program will call the <code class="language-plaintext highlighter-rouge">UDP_scan</code> function, passing in the host, start and end ports, and the timeout value. If the value of <code class="language-plaintext highlighter-rouge">scan_type</code> is not 1 or 2, it means the user has entered an invalid scan type, and the program will display an error message.</p>

<p> </p>

<h2 id="full-code"><strong>Full Code:</strong></h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;sys/socket.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;errno.h&gt;

void TCP_scan(char* host, int start_port, int end_port, struct timeval timeout) {
    for (int port = start_port; port &lt;= end_port; port++) {
        int sock = socket(AF_INET, SOCK_STREAM, 0);
        setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO, (const char*)&amp;timeout, sizeof timeout);
        struct sockaddr_in server;
        server.sin_addr.s_addr = inet_addr(host);
        server.sin_family = AF_INET;
        server.sin_port = htons(port);

        if (connect(sock, (struct sockaddr *) &amp;server, sizeof(server)) == 0) {
            char buffer[32];
            int bytes_sent = send(sock, buffer, sizeof(buffer), 0);
            if (bytes_sent &gt; 0) {
                int bytes_received = recv(sock, buffer, sizeof(buffer), 0);
                if (bytes_received &gt; 0) {
                    printf("[+] Port %d is open\n", port);
                } else if (bytes_received == -1 &amp;&amp; errno == EAGAIN) {
                    printf("[+] Port %d is open\n", port);
                }
            }
            close(sock);
        } else {
            //printf("[+] Port %d is closed\n", port);
        }
        close(sock);
    }
}

void UDP_scan(char* host, int start_port, int end_port, struct timeval timeout) {
    for (int port = start_port; port &lt;= end_port; port++) {
        int sock = socket(AF_INET, SOCK_DGRAM, 0);
        setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO, (const char*)&amp;timeout, sizeof timeout);
        struct sockaddr_in server;
        server.sin_addr.s_addr = inet_addr(host);
        server.sin_family = AF_INET;
        server.sin_port = htons(port);
        char buffer[32];
        int bytes_sent = sendto(sock, buffer, sizeof(buffer), 0, (struct sockaddr *)&amp;server, sizeof(server));
        if (bytes_sent &gt; 0) {
            int bytes_received = recv(sock, buffer, sizeof(buffer), 0);
            if (bytes_received &gt; 0) {
                printf("[+] Port %d is open\n", port);
            } else if (bytes_received == -1 &amp;&amp; errno == EAGAIN) {
                printf("[+] Port %d is open\n", port);
            }
        } else {
            //printf("[+] Port %d is closed\n", port);
        }
        close(sock);
    }
}

int main() {
    char host[256];
    int start_port, end_port;
    struct timeval timeout;
    timeout.tv_sec = 5;
   
    timeout.tv_usec = 0;
    int scan_type;
    printf("[+] N0Pspoof is a tool to bypass and evade Portspoof solution \n");
    printf("[+] By: Zeyad Azima\n");
    printf("[+] Github: https://github.com/Zeyad-Azima/N0Pspoof\n");
    printf("\n");
    printf("[+] Target Behind Portspoof: ");
    scanf("%255s", host);

    printf("[+] Enter the start port: ");
    scanf("%d", &amp;start_port);
    printf("[+] Enter the end port: ");
    scanf("%d", &amp;end_port);

    printf("[+] Choose the scan type: \n 1) TCP \n 2) UDP \n");
    scanf("%d", &amp;scan_type);
    printf("\n");
    
    

    if (scan_type == 1) {
        printf("[+] Scan Info:\n[*] Target: %s	[*] Ports Range: %d-%d	[*] Scan Type: TCP\n", host, start_port, end_port);
        TCP_scan(host, start_port, end_port, timeout);
    } else if (scan_type == 2) {
        printf("[+] Scan Info:\n[*] Target: %s	[*] Ports Range: %d-%d	[*] Scan Type: UDP\n", host, start_port, end_port);
        UDP_scan(host, start_port, end_port, timeout);
    } else {
        printf("Invalid scan type\n");
    }
    return 0;

}
</code></pre></div></div>

<p>You can also find the code on <a href="https://github.com/Zeyad-Azima/N0Pspoof">github</a>.</p>

<p> </p>

<h1 id="conclusion"><strong>Conclusion</strong></h1>

<p>Now, it’s time to compile our code using <code class="language-plaintext highlighter-rouge">gcc</code> and try it out.</p>

<ul>
  <li>Compile: <code class="language-plaintext highlighter-rouge">gcc N0Pspoof.c -o N0Pspoof</code></li>
</ul>

<p>We will perform scanning using nmap first &amp; then Our tool.</p>

<ul>
  <li>
    <p>Nmap</p>

    <p><img src="../_resources/581d9c269ab27fb406e7dd8a6429060c" alt="" /></p>

    <p> </p>
  </li>
  <li>
    <p>N0Pspoof</p>

    <p><img src="../_resources/e081d3c0f254419cf661a4800c95a675" alt="" /></p>
  </li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#defense-evasion" class="page__taxonomy-item" rel="tag">Defense Evasion</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2023-01-24T00:00:00+08:00">January 24, 2023</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/certificates/ecptx/" class="pagination--pager" title="eCPTX: The Honest Review
">Previous</a>
    
    
      <a href="/security%20research/CVE_2023_22809/" class="pagination--pager" title="CVE-2023-22809: Sudoedit Bypass - Analysis
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Zeyad Azima. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
