<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Bypass The Anti-Virus - Part 1: Introduction - Zeyad Azima</title>
<meta name="description" content="Introduction to Anti-Virus software and how it works. ">


  <meta name="author" content="Zeyad Azima">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Zeyad Azima">
<meta property="og:title" content="Bypass The Anti-Virus - Part 1: Introduction">
<meta property="og:url" content="http://localhost:5000/defense%20evasion/BypassAV1/">


  <meta property="og:description" content="Introduction to Anti-Virus software and how it works. ">



  <meta property="og:image" content="http://localhost:5000/assets/images/clasoxyjk07nb0lo1gg0j8xg4.png">





  <meta property="article:published_time" content="2022-11-23T00:00:00+08:00">





  

  


<link rel="canonical" href="http://localhost:5000/defense%20evasion/BypassAV1/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Zeyad Azima",
      "url": "http://localhost:5000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Zeyad Azima Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site_data/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site_data/favicon-16x16.png">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/site_data/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Zeyad Azima
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/#Security-Research">Security Research</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#MacOS">MacOS</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#IoT-Exploitation">IoT Exploitation</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Defense-Evasion">Defense Evasion</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#General">General</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Certificates">Certificates</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">All Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site_data/avatar.jpg" alt="Zeyad Azima" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Zeyad Azima</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Brain Storming Stuff (Exploit Development, Reverse Engineering &amp; More)</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="mailto:contact@zeyadazima.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://twitter.com/AzimaZeyad" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/zer0verflow/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/Zeyad-Azima" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/zeyadazima" rel="nofollow noopener noreferrer"><i class="fas fa-mug-hot" aria-hidden="true"></i><span class="label">Buy Me a Coffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Bypass The Anti-Virus - Part 1: Introduction">
    <meta itemprop="description" content="Introduction">
    <meta itemprop="datePublished" content="2022-11-23T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Bypass The Anti-Virus - Part 1: Introduction
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#malwares--anti-virus-history">Malwares &amp; Anti-Virus History</a></li>
  <li><a href="#how-anti-virus-works-">How Anti-Virus Works ?</a></li>
  <li><a href="#anti-virus-engines">Anti-Virus Engines</a>
    <ul>
      <li><a href="#static-engine">Static Engine</a></li>
      <li><a href="#heuristic-engine">Heuristic Engine</a></li>
      <li><a href="#unpacking-engine">Unpacking Engine</a></li>
      <li><a href="#dynamic-engine">Dynamic Engine</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

            </nav>
          </aside>
        
        <h1 id="introduction">Introduction</h1>

<p>AV (Anti-Virus) most of the common and widely used endpoint security softwares exist that almost used on both of individuals &amp; corporation Endpoints.Therefor, It’s a challenge for penetration testers/ethical hackers to run their tools/exploits “Which Consider as malicious softwares”. As a results, The AV software would be detecting the tools/exploits. But, Attackers are getting more smarter day by day. So, in this series we will discover and know about AV (Anti-Virus) software &amp; how to bypass it from scratch moving to more advanced ways.</p>

<h1 id="malwares--anti-virus-history">Malwares &amp; Anti-Virus History</h1>

<p>Viruses are the common keyword used between people. But, actually viruses are one type of the malware families &amp; types. So, what is “malware” ?. It’s a short term for “Malicious Software” as it’s name describing it as a coded and designed softwares to perform harmful activites on the system for example ( Unauthorized Access, Delete Important files, Lock the system, Encrypt Your data and many more). You might think malwares started from 10 or 20 years ago or as something new. But, The first malware came to life was on the 70’s specifically <code class="language-plaintext highlighter-rouge">1971</code> that year when <code class="language-plaintext highlighter-rouge">The Creaper</code> created and it was the first malware. And it was not performing any malicious or harmful activities. In fact, It was an experiment. So, you may be wondering what was <code class="language-plaintext highlighter-rouge">The Creaper</code> doing ?. Basically, It was just displaying a message to challenge the use to catch it. At that time also <code class="language-plaintext highlighter-rouge">The Reaper</code> was created and it was the first Anti-Virus “Anti-Malware” and the goal of creating it, Was to hunt for <code class="language-plaintext highlighter-rouge">The Creaper</code> malware and stop it. Since that time until now there were a lot of updates on the malwares from the attackers and on the endpoint security solutions from the <a href="google.com">vendors</a>.</p>

<h1 id="how-anti-virus-works-">How Anti-Virus Works ?</h1>

<p><img src="/assets/images/de51b852bdf172698f98294de7c5a25e.png" alt="de51b852bdf172698f98294de7c5a25e.png" /></p>

<p>Anti-Virus is a software like any other software we use. Therefor, it requires a lot of files and libraries to be loaded so the anti-virus software can work probebly and each got different functions and used in a spasific jobs. For example the file could be for <code class="language-plaintext highlighter-rouge">Configuration</code>,<code class="language-plaintext highlighter-rouge">Database</code>,<code class="language-plaintext highlighter-rouge">Logging</code>&amp;more. We gonna know more about these files &amp; libraries and how we could exploit them in this series. But the most important part here is to know how the anti-virus can detect and catch the malware and basically, the Anti-Virus dealing and scanning with the malware through the engines and we gonna know about each one of these engines &amp; how each one of them scan and deal the malware in different ways.</p>

<h1 id="anti-virus-engines">Anti-Virus Engines</h1>

<p><img src="/assets/images/20458a37130f52cdf306b14aff96f4b6.png" alt="20458a37130f52cdf306b14aff96f4b6.png" /></p>

<p>Now, Time to discuss the engines of the Anti-Virus and see how each of them work:</p>

<h2 id="static-engine">Static Engine</h2>

<p>First is the <code class="language-plaintext highlighter-rouge">Static Engine</code> and as we can guess from the name it’s scanning the malware statically by comparing it to a database of signatures that related to previous known malwares and check if there is a match with any of the signatures. Let’s take a deep look on the process.</p>

<p><img src="/assets/images/Untitled%20Diagram.drawio.png" alt="Untitled Diagram.drawio.png" /></p>

<p>Explaining the process in the above picture. We have the file we want to scan, The anti-virus take it and pass it or gonna use the <code class="language-plaintext highlighter-rouge">Static Engine</code> aganist it. Then, the <code class="language-plaintext highlighter-rouge">Static Engine</code> start to get the signatures and collect it all from the <code class="language-plaintext highlighter-rouge">Signatures</code> Database/File. After that, It will start to searching with the <code class="language-plaintext highlighter-rouge">Signatures</code> &amp; comparing it to the file. And if any matched signature found, It will mark the file as <code class="language-plaintext highlighter-rouge">Malicious</code>. Otherwise, It will mark the file as <code class="language-plaintext highlighter-rouge">Benign</code> which means <code class="language-plaintext highlighter-rouge">non-malicious</code>. So, You may got one of the ways to bypass this engine. By changing the malware form or code or anything could be exist in these signatures to avoid the detection from this engine. We will be talking about that in the coming parts.</p>

<h2 id="heuristic-engine">Heuristic Engine</h2>

<p>The <code class="language-plaintext highlighter-rouge">Heuristic Engine</code> is closer to the <code class="language-plaintext highlighter-rouge">Static Engine</code> but instead of using signatures. It’s using defined rules and these rules more close to the behaviour of the software and how is it acting and what it is doing. For example some Rules are <code class="language-plaintext highlighter-rouge">If the software open outbound connection</code> or <code class="language-plaintext highlighter-rouge">Try to access some files in the system32 directory</code>. If one of these rules matched with the <code class="language-plaintext highlighter-rouge">software</code> behaviour then it will be marked as a malicious software.</p>

<p><img src="/assets/images/Untitled%20Diagram.drawio1.png" alt="Untitled Diagram.drawio1.png" /></p>

<p>So, the process is as the following: The anti-virus take the file and pass it to the <code class="language-plaintext highlighter-rouge">Heuristic Engine</code> . Then, the <code class="language-plaintext highlighter-rouge">Heuristic Engine</code> start to collect the <code class="language-plaintext highlighter-rouge">pre-defined rules</code> . After that, It will start look into the file behaviour with these rules. And if any matched rule found, It will mark the file as <code class="language-plaintext highlighter-rouge">Malicious</code>. Otherwise, It will mark the file as <code class="language-plaintext highlighter-rouge">Benign</code> .</p>

<h2 id="unpacking-engine">Unpacking Engine</h2>

<p>This engine is not actually to scanning the file to see if it’s <code class="language-plaintext highlighter-rouge">Malicious</code> or <code class="language-plaintext highlighter-rouge">Benign</code>. So, what does it do ?. to understand the <code class="language-plaintext highlighter-rouge">Unpacking Engine</code> we have to know what is <code class="language-plaintext highlighter-rouge">Packing</code> &amp; <code class="language-plaintext highlighter-rouge">Unpacking</code> Actually.</p>

<ul>
  <li>What is <code class="language-plaintext highlighter-rouge">Packing</code> &amp; <code class="language-plaintext highlighter-rouge">Unpacking</code> ?
  <code class="language-plaintext highlighter-rouge">Packing</code> or <code class="language-plaintext highlighter-rouge">Software Packing</code> is a method that used to compress the actual code for the software and this method used to protect the code from being <code class="language-plaintext highlighter-rouge">reversed</code> for the normal softwares . So, the <code class="language-plaintext highlighter-rouge">Threat Actors</code> Used the same way to protect their malwares and make it hard to be analyzed. If we executed the <code class="language-plaintext highlighter-rouge">Packed</code> file it will be loaded in the memory and during the <code class="language-plaintext highlighter-rouge">RunTime</code> process the file get <code class="language-plaintext highlighter-rouge">Unpacked</code> and executed. Read More <a href="https://www.mcafee.com/blogs/enterprise/malware-packers-use-tricks-avoid-analysis-detection/">Here</a> for deep understanding.</li>
</ul>

<p>Let’s move on to the <code class="language-plaintext highlighter-rouge">Unpacking Engine</code> process. But, before we go for it, You have to know that each <code class="language-plaintext highlighter-rouge">Packing</code> process is done by a <code class="language-plaintext highlighter-rouge">Packing</code> Softwares and each software Pack the file with different algorithm And to <code class="language-plaintext highlighter-rouge">Unpacking</code> the Packed file you without having the <code class="language-plaintext highlighter-rouge">Packer</code> it will be so hard. So, the malware analyst that analysis the malware start to <code class="language-plaintext highlighter-rouge">Unpack</code> it manually and then write a script to <code class="language-plaintext highlighter-rouge">Unpack</code> it. After that add it to the <code class="language-plaintext highlighter-rouge">Unpacking Engine</code> .</p>

<p><img src="/assets/images/Untitled%20Diagram.drawio%202.png" alt="Untitled Diagram.drawio 2.png" /></p>

<p>So, here we got the Packed file the anti-virus will pass it to the <code class="language-plaintext highlighter-rouge">Unpacking Engine</code>. Then, the <code class="language-plaintext highlighter-rouge">Unpacking Engine</code> gonna to check the <code class="language-plaintext highlighter-rouge">Packed</code> file to get the <code class="language-plaintext highlighter-rouge">Packing Software</code> that used to perform the packing. And finally it will perform <code class="language-plaintext highlighter-rouge">Unpacking</code> if it’s exist in the engine and give us the <code class="language-plaintext highlighter-rouge">Unpacked</code> File. Finally it’s the time to scan the <code class="language-plaintext highlighter-rouge">Unpacked</code> File.</p>

<h2 id="dynamic-engine">Dynamic Engine</h2>
<p>Finally, the <code class="language-plaintext highlighter-rouge">Dynamic Engine</code>. As the engine name says, It’s analyzing the Malware or the targeted software dynamically By Running the targeted file inside a sandbox and start to analysis it’ behaviour and see if it’s malicious or no. So, let’s dig more deep into the dynamic engine. The <code class="language-plaintext highlighter-rouge">Dynamic Engine</code> has more than 1 way to scan for the malware as the following:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Sandboxing</code>
So first what is <code class="language-plaintext highlighter-rouge">Sandboxing</code> ? It’s a process of running the file/software inside a virtual testing environment. Therefor, the code or the software would be run will be separated from the real environment “Operating System”. In this way if the software is malicious it won’t affect your “Operating System”. As a result the <code class="language-plaintext highlighter-rouge">Dynamic Engine</code> will be able to know if its malicious or no through its suspicious behaviour.</li>
  <li><code class="language-plaintext highlighter-rouge">API Monitoring</code>
What is windows APIs ? It’s a set of functions that used by softwares/programes to perform some tasks such as <code class="language-plaintext highlighter-rouge">Crreating New Files</code>,<code class="language-plaintext highlighter-rouge">Delete Files</code>,<code class="language-plaintext highlighter-rouge">ReadFiles</code> &amp; <code class="language-plaintext highlighter-rouge">many more</code>. There are some of these APIs commonly used by threat actors malwares. So, the <code class="language-plaintext highlighter-rouge">Dynamic Engine</code> is inspecting the API calls of the software and analysis it, looking for some common used API calls that widely used by the malwares. You can see the common malwarews API calls from <a href="https://github.com/carlospolop/hacktricks/blob/master/reversing/common-api-used-in-malware.md">Here</a>.</li>
</ul>

<p><img src="/assets/images/Untitled%20Diagram.drawio%204.png" alt="Untitled Diagram.drawio 4.png" /></p>

<p>As the process shown, The anti-virus take the file and pass it to the <code class="language-plaintext highlighter-rouge">Dynamic Engine</code>. After that<code class="language-plaintext highlighter-rouge">Dynamic Engine</code> will start to analysis the file by <code class="language-plaintext highlighter-rouge">Sandboxing</code>/ <code class="language-plaintext highlighter-rouge">API Monitoring</code> after that It will mark the file as <code class="language-plaintext highlighter-rouge">Malicious</code> Based on the analysis. Otherwise, It will mark the file as <code class="language-plaintext highlighter-rouge">Benign</code> which means <code class="language-plaintext highlighter-rouge">non-malicious</code>.</p>

<h1 id="conclusion">Conclusion</h1>
<p>Overall, Nowadays we can see a massive updates in security solutions such as implementing the <code class="language-plaintext highlighter-rouge">Artificial intelligence</code> &amp; <code class="language-plaintext highlighter-rouge">Machine Learning</code>. Which making it harder for attackers to bypass the solution or the AV software. Finally, as the solutions getting smarter also, the attackers getting smarter too with their Techniques &amp; Attacks. In the coming parts we will discuss about the Common Misconfiguration, Techniques &amp; Attacks to bypass the Anti-Virus.</p>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#defense-evasion" class="page__taxonomy-item" rel="tag">Defense Evasion</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-11-23T00:00:00+08:00">November 23, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/defense%20evasion/BypassAV2/" class="pagination--pager" title="Bypass The Anti-Virus - Part 2: Common Misconfigurations, Techniques &amp; Attacks
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Zeyad Azima. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
